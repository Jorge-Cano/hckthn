<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- <meta http-equiv="Content-Security-Policy" content="script-src 'self' https://guides.fullstory.com https://guides-cdn.fullstory.com; style-src 'self' 'unsafe-inline' https://guides.fullstory.com; img-src 'self' https://guides-cdn.fullstory.com; connect-src 'self' https://guides.fullstory.com;"> -->
    <title>Behavioral Data Intelligence Sandbox v8.1</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .glass { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); }
        .inspect-pane { font-family: 'Courier New', monospace; font-size: 14px; scroll-behavior: smooth; }
        .casino-display { background: radial-gradient(circle, #1a0033 0%, #000000 100%); }
        .hidden { display: none; }
        .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 100; align-items: center; justify-content: center; backdrop-filter: blur(4px); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }
        .log-entry { animation: fadeIn 0.3s ease-out; }
        .slot-spin { animation: bounce 0.2s infinite; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
    </style>
    
    <script>
        window['_fs_host'] = 'fullstory.com';
        window['_fs_script'] = 'edge.fullstory.com/s/fs.js';
        window['_fs_org'] = 'o-2198CH-na1';
        window['_fs_namespace'] = 'FS';
        !function (m, n, e, t, l, o, g, y) {
            var s, f, a = function (h) {
                return !(h in m) || (m.console && m.console.log && m.console.log('FullStory namespace conflict. Please set window["_fs_namespace"].'), !1)
            }(e)
            ; function p(b) {
                var h, d = []; function j() {
                    h && (d.forEach((function (b) {
                        var d; try { d = b[h[0]] && b[h[0]](h[1]) } catch (h) { return void (b[3] && b[3](h)) }
                        d && d.then ? d.then(b[2], b[3]) : b[2] && b[2](d)
                    })), d.length = 0)
                } function r(b) { return function (d) { h || (h = [b, d], j()) } } return b(r(0), r(1)), {
                    then: function (b, h) { return p((function (r, i) { d.push([b, h, r, i]), j() })) }
                }
            } a && (g = m[e] = function () {
                var b = function (b, d, j, r) {
                    function i(i, c) {
                        h(b, d, j, i, c, r)
                    } r = r || 2; var c, u = /Async$/; return u.test(b) ? (b = b.replace(u, ""), "function" == typeof Promise ? new Promise(i) : p(i)) : h(b, d, j, c, c, r)
                }
                ; function h(h, d, j, r, i, c) { return b._api ? b._api(h, d, j, r, i, c) : (b.q && b.q.push([h, d, j, r, i, c]), null) } return b.q = [], b
            }(), y = function (b) {
                function h(h) {
                    "function" == typeof h[4] && h[4](new Error(b))
                } var d = g.q; if (d) { for (var j = 0; j < d.length; j++)h(d[j]); d.length = 0, d.push = h }
            }, function () {
                (o = n.createElement(t)).async = !0, o.crossOrigin = "anonymous", o.src = "https://" + l, o.onerror = function () { y("Error loading " + l) }
                    ; var b = n.getElementsByTagName(t)[0]; b && b.parentNode ? b.parentNode.insertBefore(o, b) : n.head.appendChild(o)
            }(), function () {
                function b() { }
                function h(b, h, d) { g(b, h, d, 1) } function d(b, d, j) { h("setProperties", { type: b, properties: d }, j) } function j(b, h) { d("user", b, h) } function r(b, h, d) {
                    j({
                        uid: b
                    }, d), h && j(h, d)
                } g.identify = r, g.setUserVars = j, g.identifyAccount = b, g.clearUserCookie = b, g.setVars = d, g.event = function (b, d, j) {
                    h("trackEvent", {
                        name: b, properties: d
                    }, j)
                }, g.anonymize = function () { r(!1) }, g.shutdown = function () { h("shutdown") }, g.restart = function () { h("restart") },
                    g.log = function (b, d) { h("log", { level: b, msg: d }) }, g.consent = function (b) { h("setIdentity", { consent: !arguments.length || b }) }
            }(), s = "fetch",
                f = "XMLHttpRequest", g._w = {}, g._w[f] = m[f], g._w[s] = m[s], m[s] && (m[s] = function () { return g._w[s].apply(this, arguments) }), g._v = "2.0.0")
        }(window, document, window._fs_namespace, "script", window._fs_script);
    </script>  
    
</head>
<body class="bg-slate-100 text-slate-800 min-h-screen p-6 font-sans">

    <div id="security-modal" class="modal-overlay" onclick="closeSecurityModal()">
        <div class="bg-white p-8 rounded-2xl max-w-md w-full mx-4 shadow-2xl border-t-8 border-red-600" onclick="event.stopPropagation()">
            <div class="w-16 h-16 bg-red-100 text-red-600 rounded-full flex items-center justify-center mb-6 mx-auto">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                </svg>
            </div>
            <h2 class="text-2xl font-black text-center text-slate-900 mb-2">High-Risk Transfer</h2>
            <p class="text-slate-500 text-center text-sm mb-8 leading-relaxed">Account <strong>VIP-9921</strong> has triggered a manual security review for offshore routing. A Private Wealth officer will contact you shortly.</p>
            <button onclick="closeSecurityModal()" class="w-full py-4 bg-slate-900 text-white rounded-xl font-bold shadow-lg hover:bg-black transition uppercase tracking-widest text-xs">Acknowledge Alert</button>
        </div>
    </div>

    <header class="max-w-7xl mx-auto flex justify-between items-center mb-6">
        <h1 class="text-xl font-black text-slate-900 tracking-tight uppercase">Behavioral<span class="text-indigo-600">Intel</span>.v8.1</h1>
        <button onclick="fetchSessionSummary()" class="bg-indigo-600 text-white px-5 py-2 rounded-lg font-bold shadow-lg hover:bg-indigo-700 transition">‚ú® Session Summary API</button>
    </header>

    <main class="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-12 gap-6">
        
        <div class="lg:col-span-7 space-y-6">
            <nav class="flex gap-2">
                <button onclick="switchDemo('fintech')" class="px-4 py-2 rounded bg-white border border-slate-200 shadow-sm font-bold text-xs uppercase tracking-wider">Wealth Management</button>
                <button onclick="switchDemo('gaming')" class="px-4 py-2 rounded bg-white border border-slate-200 shadow-sm font-bold text-xs uppercase tracking-wider">High-Roller Roulette</button>
                <button onclick="switchDemo('ai')" class="px-4 py-2 rounded bg-white border border-slate-200 shadow-sm font-bold text-xs uppercase tracking-wider">AI Search Agent</button>
            </nav>

            <section id="demo-fintech" class="demo-section glass p-10 rounded-2xl shadow-xl border border-slate-200">
                <div class="flex justify-between items-start mb-8">
                    <h2 class="text-2xl font-bold">Prime Wealth Advising</h2>
                    <div class="text-right">
                        <p class="text-[10px] uppercase font-black text-slate-400">Risk Rating</p>
                        <p class="text-lg font-bold text-orange-600">Moderate-High</p>
                    </div>
                </div>
                
                <div class="grid grid-cols-2 gap-4 mb-8">
                    <div class="p-6 bg-slate-900 text-white rounded-xl border border-slate-700">
                        <p class="text-[10px] text-slate-400 uppercase font-bold mb-1">Portfolio Balance</p>
                        <p id="fin-balance" class="text-3xl font-mono">$2,450,000</p>
                    </div>
                    <div class="p-6 bg-white border-2 border-slate-100 rounded-xl">
                        <p class="text-[10px] text-slate-400 uppercase font-bold mb-1">Total Invested (Session)</p>
                        <p id="fin-total-invested" class="text-3xl font-mono text-blue-600">$0</p>
                    </div>
                </div>
                
                <div class="flex flex-wrap gap-4">
                    <button onmouseenter="startHoverTimer('Deposit_5k')" onmouseleave="clearHoverTimer()" onclick="processInvest(5000)" class="bg-blue-600 text-white px-6 py-3 rounded-lg font-bold">Deposit $5,000</button>
                    <button onmouseenter="startHoverTimer('Whale_Invest')" onmouseleave="clearHoverTimer()" onclick="processInvest(1000000)" class="bg-slate-800 text-white px-6 py-3 rounded-lg font-bold">Invest $1M (Whale)</button>
                    <button onclick="offshoreTransfer()" class="bg-red-50 text-red-600 border border-red-200 px-6 py-3 rounded-lg font-bold hover:bg-red-100">Instant Transfer to Offshore</button>
                </div>
            </section>

            <section id="demo-gaming" class="demo-section hidden casino-display p-10 rounded-2xl shadow-2xl text-white">
                <div class="flex justify-between items-start mb-8 border-b border-white/10 pb-6">
                    <h2 class="text-3xl font-bold text-purple-400 italic">High-Roller Roulette</h2>
                    <div class="text-right space-y-2">
                        <div class="text-[11px] uppercase tracking-widest text-slate-400 font-bold">Spent: <span id="casino-spent" class="text-4xl text-red-500 font-mono ml-2">$0</span></div>
                        <div class="text-[11px] uppercase tracking-widest text-slate-400 font-bold">Won: <span id="casino-won" class="text-4xl text-green-500 font-mono ml-2">$0</span></div>
                    </div>
                </div>
                <div class="flex flex-col items-center justify-center py-12 bg-black/30 rounded-3xl border border-white/5 mb-8">
                    <div id="slot-result" class="text-8xl mb-6">üé∞</div>
                    <p id="game-status" class="text-xl font-bold h-8 tracking-widest uppercase text-white/50"></p>
                </div>
                <div class="flex justify-center">
                    <button onclick="playGame()" class="bg-yellow-500 text-black px-16 py-5 rounded-full text-2xl font-black shadow-lg">SPIN ($1,000)</button>
                </div>
            </section>

            <section id="demo-ai" class="demo-section hidden glass p-10 rounded-2xl shadow-xl border border-slate-200">
                <h2 class="text-2xl font-bold mb-6">Nova Intelligence Agent</h2>
                <div class="flex gap-2 mb-10">
                    <input type="text" id="ai-input" placeholder="Search wealth trends..." class="flex-1 p-4 border-2 rounded-xl outline-none focus:border-indigo-500">
                    <button onclick="aiSearch()" class="bg-slate-900 text-white px-8 py-4 rounded-xl font-bold hover:bg-black transition">Run Query</button>
                </div>
                <div id="ai-results-area" class="space-y-6"></div>
            </section>
        </div>

        <aside class="lg:col-span-5 bg-slate-900 rounded-2xl p-6 text-white shadow-2xl h-[750px] flex flex-col border border-slate-800">
            <h3 class="text-[11px] font-black uppercase tracking-widest text-slate-500 border-b border-slate-800 pb-4 mb-4">Live Behavioral Stream</h3>
            <div id="inspect-content" class="inspect-pane overflow-y-auto flex-1 space-y-4 pr-2"></div>
        </aside>
    </main>

    <div id="summary-modal" class="modal-overlay" onclick="this.style.display='none'">
        <div class="bg-white p-8 rounded-2xl max-w-2xl w-full mx-4 shadow-2xl" onclick="event.stopPropagation()">
            <h2 class="text-2xl font-bold mb-6 flex items-center gap-2">‚ú® AI Session Analysis</h2>
            <div id="summary-content" class="space-y-6 text-slate-700"></div>
            <button onclick="document.getElementById('summary-modal').style.display='none'" class="mt-8 w-full py-4 bg-indigo-600 text-white rounded-xl font-bold">Dismiss Analysis</button>
        </div>
    </div>

    <!-- UI update from GCP Function -->
    <div id="fs-alert-box" style="display:none; position:fixed; bottom:20px; right:20px; background:#fff; border:1px solid #ddd; padding:20px; box-shadow:0 4px 10px rgba(0,0,0,0.1); z-index:9999; border-radius:8px; max-width:300px;">
        <p id="fs-alert-text"></p>
        <button onclick="document.getElementById('fs-alert-box').style.display='none'">Dismiss</button>
    </div>    

    <script>
        const userState = { id: "VIP-9921", name: "Alexander Sterling", tier: "Private Client", propensity: 0.94, finInv: 0, casSpent: 0, casWon: 0, spins: 0, hesitations: 0, searchClicks: 0, searches: 0 };
        let hoverTimer;

        document.getElementById('ai-input').addEventListener('keypress', (e) => { if (e.key === 'Enter') aiSearch(); });

        function streamEvent(eventName, properties) {
            const enriched = { ...properties, user_id: userState.id, propensity: userState.propensity };
            try { if (typeof FS !== 'undefined' && typeof FS.event === 'function') FS.event(eventName, enriched); } catch (e) {}

            const pane = document.getElementById('inspect-content');
            const entry = document.createElement('div');
            entry.className = "log-entry p-4 bg-white/5 rounded-lg border-l-4 border-indigo-500";
            entry.innerHTML = `<div class="text-indigo-400 font-black mb-2 uppercase tracking-wide text-xs">${eventName}</div>` +
                Object.entries(enriched).map(([k,v]) => `<div class="flex justify-between border-b border-white/5 py-1"><span class="text-slate-500 font-mono">${k}</span><span class="text-indigo-200 font-bold font-mono">${v}</span></div>`).join('');
            pane.prepend(entry);
        }

        function offshoreTransfer() {
            document.getElementById('security-modal').style.display = 'flex';
            streamEvent("Security_Alert", { action: "Offshore_Transfer", status: "Flagged", risk_level: "High", session_id: "XJ-990" });
        }

        function closeSecurityModal() {
            document.getElementById('security-modal').style.display = 'none';
        }

        // OTHER FUNCTIONS REMAIN IDENTICAL TO V8
        function startHoverTimer(target) { hoverTimer = setTimeout(() => { userState.hesitations++; streamEvent("User_Hesitation", { target, duration: "1.5s+" }); }, 1500); }
        function clearHoverTimer() { clearTimeout(hoverTimer); }
        function switchDemo(t) {
            document.querySelectorAll('.demo-section').forEach(s => s.classList.add('hidden'));
            document.getElementById(`demo-${t}`).classList.remove('hidden');
            streamEvent("Context_Switch", { mode: t });
        }
        function processInvest(amt) {
            userState.finInv += amt;
            document.getElementById('fin-total-invested').innerText = `$${userState.finInv.toLocaleString()}`;
            streamEvent("Fin_Action", { action: "Investment", amount: amt, session_total: userState.finInv });
        }
        function playGame() {
            const res = document.getElementById('slot-result');
            const stat = document.getElementById('game-status');
            const spinAmount = 1000;
            res.innerText = "üé∞"; res.classList.add('slot-spin'); stat.innerText = "Spinning...";
            setTimeout(() => {
                res.classList.remove('slot-spin'); userState.spins++; userState.casSpent += spinAmount;
                const win = userState.spins <= 2; const winAmt = win ? 5000 : 0; userState.casWon += winAmt;
                document.getElementById('casino-spent').innerText = `$${userState.casSpent.toLocaleString()}`;
                document.getElementById('casino-won').innerText = `$${userState.casWon.toLocaleString()}`;
                res.innerText = win ? "üíé üíé üíé" : "üçã üçí üçã"; stat.innerText = win ? "JACKPOT!" : "TRY AGAIN";
                stat.className = win ? "text-xl font-black text-green-400" : "text-xl font-bold text-red-500";
                streamEvent("Casino_Result", { outcome: win ? "WIN" : "LOSS", spin_amount: spinAmount, payout: winAmt, total_spent: userState.casSpent });
            }, 800);
        }
        function aiSearch() {
            userState.searches++;
            const query = document.getElementById('ai-input').value || "Market Volatility";
            const area = document.getElementById('ai-results-area');
            area.innerHTML = "";
            const results = [
                { t: `Predictive Analysis: ${query} in 2026`, d: `How ${query} impacts high-net-worth portfolio stability and liquidity.` },
                { t: `Asset Correlation & ${query}`, d: `Examining the behavioral signals of users searching for ${query} during market dips.` }
            ];
            results.forEach((res, i) => {
                const card = document.createElement('div');
                card.className = "p-6 bg-white border border-slate-200 rounded-xl shadow-sm log-entry";
                card.innerHTML = `<h4 class="font-black text-indigo-600 mb-2">${res.t}</h4><p class="text-sm text-slate-500 mb-4">${res.d}</p>
                    <div class="flex gap-4 border-t pt-4">
                        <button onclick="userState.searchClicks++; streamEvent('AI_Feedback', {query:'${query}', sentiment: 'Helpful', idx: ${i}})" class="text-xs font-bold px-3 py-1 bg-green-50 text-green-700 rounded hover:bg-green-100">üëç Helpful</button>
                        <button onclick="userState.searchClicks++; streamEvent('AI_Feedback', {query:'${query}', sentiment: 'Poor', idx: ${i}})" class="text-xs font-bold px-3 py-1 bg-red-50 text-red-700 rounded hover:bg-red-100">üëé Poor</button>
                    </div>`;
                area.appendChild(card);
            });
            streamEvent("AI_Search", { query, results_count: results.length });
        }
        async function fetchSessionSummary() {
            const modal = document.getElementById('summary-modal');
            const content = document.getElementById('summary-content');
            modal.style.display = 'flex';
            content.innerHTML = `<div class="animate-pulse font-mono">Querying Session API...</div>`;
            setTimeout(() => {
                const searchEfficiency = userState.searches > 0 ? Math.round((userState.searchClicks / userState.searches) * 100) : 0;
                content.innerHTML = `<div class="grid grid-cols-2 gap-4">
                        <div class="p-4 bg-slate-50 rounded-xl border-l-4 border-indigo-500"><p class="text-[10px] uppercase font-black text-slate-500">Profile</p><p class="text-sm font-bold text-orange-600">Moderate-High Risk Rating</p></div>
                        <div class="p-4 bg-slate-50 rounded-xl border-l-4 border-emerald-500"><p class="text-[10px] uppercase font-black text-slate-500">AI Relevance</p><p class="text-sm font-bold">${searchEfficiency}% Engagement</p></div>
                    </div>
                    <div class="p-4 bg-blue-50 rounded-xl border border-blue-100 text-xs"><strong>Behavioral Context:</strong> User performed <strong>${userState.searches} searches</strong>.</div>
                    <div class="p-4 bg-amber-50 rounded-xl border border-amber-100 text-xs italic">User demonstrated <strong>${userState.hesitations} hesitations</strong> on large wealth deposits.</div>`;
                streamEvent("API_Summary_Success", { risk_rating: "Moderate-High", efficiency: searchEfficiency });
            }, 1000);
        }
    </script>
<!-- Script start -->
  <!-- <script>
  (function (w, d, s) {
      var a = d.getElementsByTagName('head')[0];
      var r = d.createElement('script');
      r.async = 1;
      r.src = s;
      r.setAttribute('id', 'usetifulScript');
      r.dataset.orgId = "o-2198CH-na1";  // This is your organization ID.
     
      r.dataset.apiHostname = "https://guides.fullstory.com";
      a.appendChild(r);
    })(window, document, "https://guides.fullstory.com/dist/gs.js");
  </script> -->
<!-- Script end -->
    
    <!-- <script>
        (function (w, d, s) {
            var a = d.getElementsByTagName('head')[0];
            var r = d.createElement('script');
            r.async = 1;
            r.src = s;
            r.setAttribute('id', 'usetifulScript');
            r.dataset.token = "0d98c945cb27c8a94f8752d06a21a809";  // This is your unique token. Don‚Äôt change it.
            r.dataset.apiHostname = "https://guides.fullstory.com";
            a.appendChild(r);
            })(window, document, "https://guides.fullstory.com/dist/gs.js");
    </script> -->

    <!-- <script>
      window['_fs_ready'] = function() {
        // Only load Guides once FullStory has confirmed it is ready and recording
        (function (w, d, s) {
            var a = d.getElementsByTagName('head')[0];
            var r = d.createElement('script');
            r.async = 1;
            r.src = s;
            r.setAttribute('id', 'usetifulScript');
            r.dataset.token = "0d98c945cb27c8a94f8752d06a21a809";
            r.dataset.apiHostname = "https://guides.fullstory.com";
            a.appendChild(r);
        })(window, document, "https://guides.fullstory.com/dist/gs.js");
      };
    </script>     -->

    
    <script>
      window['_fs_ready'] = function() {
        // Only load Guides once FullStory has confirmed it is ready and recording
        (function (w, d, s) {
            var a = d.getElementsByTagName('head')[0];
            var r = d.createElement('script');
            r.async = 1;
            r.src = s;
            r.setAttribute('id', 'usetifulPluginScript');
            r.dataset.token = "0d98c945cb27c8a94f8752d06a21a809";
            r.dataset.apiHostname = "https://guides.fullstory.com";
            a.appendChild(r);
        })(window, document, "https://guides.fullstory.com/dist/gs.js");
      };
    </script>


    <!-- GCP polling - to be activated once published -->
    <!-- <script>
      // This waits for Fullstory to be ready
      window['_fs_ready'] = function() {
        const sessionId = FS.getCurrentSession();
        const bucketUrl = "https://storage.googleapis.com/your-public-ui-bucket";
    
        // Start checking for a message every 5 seconds
        const pollInterval = setInterval(async () => {
          try {
            const response = await fetch(`${bucketUrl}/${sessionId}.json`);
            
            if (response.ok) {
              const data = await response.json();
              if (data.show) {
                document.getElementById('fs-alert-text').innerText = data.text;
                document.getElementById('fs-alert-box').style.display = 'block';
                
                // Stop polling once we've shown the message
                clearInterval(pollInterval);
              }
            }
          } catch (e) {
            // File doesn't exist yet, which is normal
          }
        }, 5000);
      };
    </script> -->
    
</body>
</html>
